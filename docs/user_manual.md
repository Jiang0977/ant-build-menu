# Ant Build Menu 用户手册

## 概述

Ant Build Menu 是一个Windows右键菜单扩展工具，允许用户直接右键点击`build.xml`文件来执行Apache Ant构建任务，无需手动打开命令行。

## 主要功能

- 🖱️ **右键菜单集成**: 在`build.xml`文件上右键即可运行Ant构建
- 🎯 **目标选择**: 图形界面选择构建目标
- 📊 **实时输出**: 显示构建过程的实时输出
- 📁 **日志管理**: 自动保存构建日志到文件
- ⚙️ **环境检测**: 自动检测Java和Ant环境
- 🔧 **配置灵活**: 支持自定义配置选项

## 基本使用

### 1. 启动构建

1. **找到build.xml文件**: 在Windows资源管理器中定位您的`build.xml`文件
2. **右键点击**: 在文件上点击鼠标右键
3. **选择菜单项**: 点击"运行 Ant 构建"选项
4. **构建界面**: 将打开Ant Build Menu图形界面

### 2. 选择构建目标

在构建界面中：

1. **查看项目信息**: 界面顶部显示项目名称和可用目标数量
2. **选择目标**: 从下拉框中选择要执行的构建目标
   - `(使用默认目标)`: 使用build.xml中定义的默认目标
   - 其他选项: 显示build.xml中定义的所有目标
3. **开始构建**: 点击"🚀 开始构建"按钮

### 3. 监控构建过程

构建开始后：

- **进度条**: 显示构建正在进行
- **实时输出**: 在文本区域显示构建过程的输出
- **状态栏**: 显示当前状态
- **取消选项**: 可以点击"❌ 取消"按钮中止构建

### 4. 查看构建结果

构建完成后：

- **成功**: 显示绿色成功消息和执行时间
- **失败**: 显示红色失败消息和错误信息
- **日志文件**: 自动保存详细日志到`ant-build-logs`目录
- **输出查看**: 可以在界面中查看完整的标准输出和错误输出

## 界面详解

### 主界面元素

```
┌─────────────────────────────────────────────────────────┐
│ Ant Build Menu - build.xml                             │
├─────────────────────────────────────────────────────────┤
│ 构建文件: C:\project\build.xml                         │
│ 项目: MyProject | 默认目标: compile | 可用目标: 5个     │
│                                                         │
│ 构建目标: [下拉框选择]                                   │
│                                                         │
│ [🚀 开始构建] [❌ 取消] [🚪 关闭]                       │
│                                                         │
│ 构建输出:                                               │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ build.xml解析成功                                │ │
│ │ 📁 项目: MyProject                                 │ │
│ │ 🎯 可用目标: compile, build, clean, test, package   │ │
│ │                                                     │ │
│ │ [构建输出将在这里显示...]                            │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ [进度条]                                                │
│ 状态: 就绪 - 找到 5 个构建目标                          │
└─────────────────────────────────────────────────────────┘
```

### 按钮功能

- **🚀 开始构建**: 启动选定目标的构建过程
- **❌ 取消**: 中止正在进行的构建（构建时可用）
- **🚪 关闭**: 关闭应用程序

### 状态指示

- **就绪**: 准备开始构建
- **正在解析**: 正在解析build.xml文件
- **正在构建**: 构建过程进行中
- **构建成功**: 构建完成且成功
- **构建失败**: 构建失败
- **构建错误**: 构建过程中发生错误

## 高级功能

### 1. 自定义配置

编辑`config/settings.json`文件来自定义行为：

```json
{
    "menu_config": {
        "menu_text": "Run Ant Build",
        "menu_text_cn": "运行 Ant 构建",
        "registry_key": "AntBuildMenu"
    },
    "ant_config": {
        "timeout_seconds": 300,
        "show_output": true,
        "open_log_after_build": false,
        "common_targets": [
            "compile", "build", "clean", "test", "package", "deploy"
        ]
    },
    "ui_config": {
        "show_target_selection": true,
        "language": "auto",
        "theme": "default"
    },
    "logging": {
        "level": "INFO",
        "log_file": "ant_build.log",
        "max_log_size_mb": 10,
        "backup_count": 3
    },
    "paths": {
        "ant_home": "",
        "java_home": "",
        "work_dir": ""
    }
}
```

### 2. 日志管理

构建日志自动保存在项目目录下的`ant-build-logs`文件夹中：

- **文件命名**: `ant_build_YYYYMMDD_HHMMSS.log`
- **内容包含**: 
  - 构建信息（文件路径、目标、结果）
  - 环境信息（Java、Ant版本和路径）
  - 完整的标准输出和错误输出
  - 执行时间统计

### 3. 环境检测

应用程序会自动检测和验证：

- **Java环境**: 检查JAVA_HOME和java.exe
- **Ant环境**: 检查ANT_HOME和ant.bat
- **文件权限**: 验证对build.xml和工作目录的访问权限

## 故障排除

### 常见问题

#### 1. 构建失败
**可能原因**:
- Java或Ant环境配置错误
- build.xml文件语法错误
- 缺少依赖文件或库

**解决方法**:
- 检查环境变量JAVA_HOME和ANT_HOME
- 验证build.xml语法
- 查看详细错误日志

#### 2. 界面无法打开
**可能原因**:
- Python环境问题
- 依赖库缺失
- 文件权限问题

**解决方法**:
- 确认Python和依赖库已正确安装
- 以管理员身份运行
- 检查防病毒软件是否阻止

#### 3. 右键菜单消失
**可能原因**:
- 注册表项被删除或损坏
- Windows系统更新影响

**解决方法**:
- 重新运行安装程序
- 重启Windows资源管理器
- 手动检查注册表项

### 调试技巧

#### 启用详细日志
修改配置文件中的日志级别：
```json
{
    "logging": {
        "level": "DEBUG"
    }
}
```

#### 命令行测试
直接从命令行运行主程序进行测试：
```cmd
python main.py "C:\path\to\build.xml"
```

#### 环境验证
运行环境检查：
```cmd
python src/installer.py --status
```

## 最佳实践

### 1. 项目组织
- 将build.xml放在项目根目录
- 确保相对路径正确
- 添加详细的target描述

### 2. 构建优化
- 使用适当的构建目标
- 设置合理的超时时间
- 定期清理构建输出

### 3. 日志管理
- 定期清理旧日志文件
- 保存重要构建日志
- 使用日志分析构建问题

### 4. 环境维护
- 保持Java和Ant版本更新
- 备份重要配置
- 定期验证环境配置

## 快捷键

在构建界面中可用的快捷键：

- **Enter**: 开始构建（当焦点在构建按钮上时）
- **Escape**: 关闭应用程序
- **Ctrl+C**: 复制选中的输出文本
- **Ctrl+A**: 选择所有输出文本

## 更新和维护

### 检查更新
- 定期检查项目GitHub页面的新版本
- 查看更新日志了解新功能和修复

### 配置备份
建议备份重要配置文件：
- `config/settings.json`
- 自定义的构建脚本

### 性能优化
- 清理旧日志文件
- 定期重启应用程序
- 监控系统资源使用情况

## 技术支持

如需帮助：
1. 查看本用户手册
2. 检查安装指南
3. 查看项目GitHub页面的FAQ
4. 提交Issue报告问题 